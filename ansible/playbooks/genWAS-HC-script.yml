- name: Performing WAS health check
  hosts: "{{ variable_host }}" 
  become: true
  become_user: wasuser
  vars_files:
    - roles/common/vars/was.yml
  tasks:


    - name: Run shc
      script: 'roles/common/scripts/was-shc.sh > /var/tmp/ISC-ans-{{ ansible_hostname }}-websphere.html'
      register: copy
    - debug: var=copy

    - name: finding files
      find:
       paths:            "{{ find_where }}"
       patterns:         "{{ find_what }}"
       recurse:          "no"
       file_type:        "file"
      register: find_result

# \/ for debugging
    - name: print find_result
      debug: var=find_result

    - name: Copy the file to 691
      fetch:
        src: "{{ item.path }}"
        dest: "{{ shc_dest }}"
        flat: yes
      with_items: "{{ find_result.files }}"
      become: true
      become_user: wasuser
      register: copy
    - debug: var=copy


#    - template:
#        src: roles/common/templates/HC-websphere-html.j2
#        dest: "/home/wasuser/wis/scripts/HC-websphere-html2.sh"
#        owner: wasuser
#        group: wasgrp
#        mode: '0750'
#      become: true
#      become_user: wasuser

#    - name: Find non-compliant files under Install Root 
#      shell: /home/wasuser/wis/scripts/HC-websphere-html2.sh >> /var/tmp/ISC2-{{ ansible_hostname }}-websphere.html
#      become: true
#      become_user: wasuser


#    - name: Copy the file to 691
#      fetch:
#        src: /var/tmp/ISC2-{{ ansible_hostname }}-websphere.html
#        dest: /var/tmp/
#        flat: yes
#      become: true
#      become_user: wasuser
#      register: copy 
#    - debug: var=copy

